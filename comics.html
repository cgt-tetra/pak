<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CÃ³mics Â· CGT TetraPak</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœŠ</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Source+Serif+4:ital,wght@0,300;0,400;0,600;1,300&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<nav>
  <a href="index.html" class="nav-logo">âœŠ <span>CGT</span> TETRAPAK</a>
  <ul class="nav-links">
    <li><a href="index.html">Inicio</a></li>
    <li><a href="actas.html">Actas</a></li>
    <li><a href="comics.html" class="active">CÃ³mics</a></li>
  </ul>
</nav>

<div id="comics" style="padding-top: 120px;">
  <div class="inner">
    <div class="section-header reveal">
      <p class="section-label">GalerÃ­a Completa</p>
      <h2 class="section-title">TODOS LOS CÃ“MICS<br>DE REUNIONES</h2>
      <div class="section-divider"></div>
    </div>

    <div class="filters reveal">
      <div class="filter-group">
        <label for="search">ğŸ” Buscar:</label>
        <input type="text" id="search" placeholder="TÃ­tulo del cÃ³mic...">
      </div>

      <div class="filter-group">
        <label for="date-filter">ğŸ“… Fecha:</label>
        <input type="month" id="date-filter">
      </div>
    </div>

    <div id="comics-count" style="font-family:'Courier Prime',monospace;font-size:0.75rem;color:#666;margin-bottom:1rem;text-align:center;"></div>

    <div id="comics-container" class="reveal"></div>
  </div>
</div>

<footer>
  <p>âœŠ <strong>CGT Tetra Pak Envases S.A.</strong> Â· SecciÃ³n Sindical Â· Arganda del Rey, Madrid</p>
  <p style="margin-top:0.5rem;">
    <a href="https://linktr.ee/CGTTetraPak" target="_blank">Linktree</a> Â·
    <a href="https://chat.whatsapp.com/I9oRl9Ud369EzwdWAlFabI" target="_blank">WhatsApp</a> Â·
    <a href="https://cgt.org.es" target="_blank">CGT Nacional</a>
  </p>
  <p style="margin-top:1rem; color:#222;">Defendiendo tus derechos</p>
</footer>

<div id="modal-overlay" onclick="closeModal(event)">
  <div id="modal-box">
    <img id="modal-img" src="" alt="">
    <div id="modal-html-container" style="background:white;max-width:90vw;max-height:85vh;overflow:auto;display:none;"></div>
  </div>
  <button id="modal-close" onclick="closeModalDirect()">âœ•</button>
</div>

<script src="common.js"></script>
<script>
let allComics = [];
let filteredComics = [];

async function loadAllComics() {
  const container = document.getElementById('comics-container');
  try {
    const res = await fetch('comics/index.json');
    if (!res.ok) throw new Error('no index');
    let data = await res.json();

    if (data.length && typeof data[0] === 'string') {
      data = data.map(f => ({ archivo: f, titulo: '', fecha: '' }));
    }

    allComics = data
      .map(item => ({...item, ...formatFileName(item.archivo)}))
      .sort((a,b) => b.dateSort.localeCompare(a.dateSort));

    filteredComics = [...allComics];
    renderComics();

  } catch(e) {
    container.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#555;padding:4rem;">No hay cÃ³mics disponibles</p>`;
  }
}

function renderComics() {
  const container = document.getElementById('comics-container');
  const count = document.getElementById('comics-count');

  count.textContent = `Mostrando ${filteredComics.length} de ${allComics.length} cÃ³mics`;

  if (!filteredComics.length) {
    container.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#555;padding:4rem;">No se encontraron cÃ³mics con estos filtros</p>`;
    return;
  }

  container.innerHTML = filteredComics.map(item => {
    const displayTitle = item.titulo || item.title;
    const isHtml = item.archivo.endsWith('.html');
    const isImg = /\.(png|jpg|jpeg|gif|webp)$/i.test(item.archivo);
    const tag = isHtml ? 'HTML' : 'IMAGEN';

    const thumb = isImg
      ? `<img class="comic-thumb" src="comics/${item.archivo}" alt="${displayTitle}" loading="lazy">`
      : `<div class="comic-thumb-placeholder"><span class="ph-icon">ğŸ¨</span><span class="ph-label">CÃ“MIC ${tag}</span></div>`;

    return `
      <div class="comic-card" onclick="${isHtml ? `openModal('comics/${item.archivo}', true)` : `openModal('comics/${item.archivo}')`}">
        ${thumb}
        <div class="comic-expand-btn">â›¶</div>
        <div class="comic-card-body">
          <div class="comic-tag">${tag}</div>
          <div class="comic-card-title">${displayTitle}</div>
          <div class="comic-card-meta">${item.date}</div>
        </div>
      </div>`;
  }).join('');
}

function applyFilters() {
  const searchTerm = document.getElementById('search').value.toLowerCase();
  const dateFilter = document.getElementById('date-filter').value;

  filteredComics = allComics.filter(item => {
    // Search
    const titleMatch = (item.titulo || item.title).toLowerCase().includes(searchTerm);
    if (!titleMatch) return false;

    // Date
    if (dateFilter) {
      const itemYYYYMM = item.dateSort ? item.dateSort.substring(0,6) : '';
      const filterYYYYMM = dateFilter.replace('-','');
      if (itemYYYYMM !== filterYYYYMM) return false;
    }

    return true;
  });

  renderComics();
}

document.getElementById('search').addEventListener('input', applyFilters);
document.getElementById('date-filter').addEventListener('change', applyFilters);

loadAllComics();
</script>

</body>
</html>
